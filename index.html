<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RepoVerse Supercluster 🌌</title>
<style>
  body { margin:0; background:#111; font-family:sans-serif; color:white; overflow:hidden;}
  canvas { display:block; }
  #controls { position:absolute; top:10px; left:10px; z-index:10; }
  input, button { padding:5px; border-radius:4px; border:none; margin-bottom:5px; cursor:pointer; }
  #infoBox {
    position:absolute; top:10px; right:10px; background:rgba(20,20,20,0.9);
    padding:15px; border-radius:8px; width:300px; display:none; z-index:10;
  }
</style>
</head>
<body>

<div id="controls">
  <input id="username" placeholder="GitHub Username / Org">
  <button id="loadBtn">Load Galaxy/Cluster</button>
  <button id="featuredBtn">Featured Repos</button>
</div>

<div id="infoBox"></div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let galaxies = []; // array of galaxy objects
let planets = [];
let zoomScale = 1;
let offsetX = 0;
let offsetY = 0;
let zoomTarget = null;

const infoBox = document.getElementById('infoBox');

// Language color mapping
function languageToColor(lang) {
  switch(lang){
    case "JavaScript": return "#f1e05a";
    case "C#": return "#178600";
    case "C": return "#a8b9cc";
    case "Python": return "#3572A5";
    case "HTML": return "#e34c26";
    default: return "#888";
  }
}

// Fetch user repos (max 50 for realistic slice)
async function fetchRepos(username){
  try{
    const res = await fetch(`https://api.github.com/users/${username}/repos?per_page=50`);
    if(!res.ok) throw new Error("User/Org not found");
    return await res.json();
  } catch(e){
    alert(e.message);
    return [];
  }
}

// Fetch org members
async function fetchOrgMembers(org){
  try{
    const res = await fetch(`https://api.github.com/orgs/${org}/members?per_page=50`);
    if(!res.ok) throw new Error("Org not found");
    return await res.json();
  } catch(e){
    alert(e.message);
    return [];
  }
}

// Build galaxy for a user
function buildGalaxy(repos, centerX, centerY){
  let galaxyPlanets = [];
  const radiusStep = 50;
  repos.forEach((repo,i)=>{
    const angle = (i/repos.length)*2*Math.PI;
    const r = radiusStep + (i%5)*20;
    galaxyPlanets.push({
      x: centerX + Math.cos(angle)*r,
      y: centerY + Math.sin(angle)*r,
      size: Math.log(repo.stargazers_count + 5)*3,
      color: languageToColor(repo.language),
      repo: repo
    });
  });
  return galaxyPlanets;
}

// Draw all galaxies and planets
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  galaxies.forEach(g => {
    // draw galaxy center
    ctx.beginPath();
    ctx.arc(g.x*zoomScale + offsetX, g.y*zoomScale + offsetY, 20*zoomScale, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
    
    // draw planets
    g.planets.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x*zoomScale + offsetX, p.y*zoomScale + offsetY, p.size*zoomScale, 0, Math.PI*2);
      ctx.fillStyle = p.color;
      ctx.fill();
    });
  });
}

// Click handler
canvas.addEventListener('click', async (e)=>{
  const mx = (e.clientX - offsetX)/zoomScale;
  const my = (e.clientY - offsetY)/zoomScale;
  
  // Planet click
  for(let g of galaxies){
    for(let p of g.planets){
      const dx = mx - p.x;
      const dy = my - p.y;
      if(Math.sqrt(dx*dx+dy*dy) <= p.size){
        showRepoInfo(p.repo);
        return;
      }
    }
  }
  
  // Galaxy click
  for(let g of galaxies){
    const dx = mx - g.x;
    const dy = my - g.y;
    if(Math.sqrt(dx*dx+dy*dy) < 30){
      zoomTarget = g;
      return;
    }
  }
});

function showRepoInfo(repo){
  infoBox.style.display = 'block';
  infoBox.innerHTML = `
    <h2>${repo.name}</h2>
    <p>${repo.description || "No description"}</p>
    <p>⭐ Stars: ${repo.stargazers_count}</p>
    <p>🍴 Forks: ${repo.forks_count}</p>
    <p>💬 Language: ${repo.language || "N/A"}</p>
    <a href="${repo.html_url}" target="_blank">🔗 Visit Repo</a>
  `;
}

// Smooth zoom animation
function animate(){
  requestAnimationFrame(animate);
  if(zoomTarget){
    const targetX = canvas.width/2 - zoomTarget.x*3;
    const targetY = canvas.height/2 - zoomTarget.y*3;
    offsetX += (targetX - offsetX)*0.1;
    offsetY += (targetY - offsetY)*0.1;
    zoomScale += (3 - zoomScale)*0.1;
  } else {
    zoomScale += (1 - zoomScale)*0.1;
    offsetX += (0 - offsetX)*0.1;
    offsetY += (0 - offsetY)*0.1;
  }
  draw();
}
animate();

// Load user or org galaxy/cluster
document.getElementById('loadBtn').addEventListener('click', async ()=>{
  const input = document.getElementById('username').value.trim();
  if(!input) return;
  galaxies = [];
  planets = [];
  
  // Try fetching as org
  let members = await fetchOrgMembers(input);
  if(members.length > 0){
    // build cluster
    const spacing = 200;
    for(let i=0;i<members.length;i++){
      const member = members[i];
      const repos = await fetchRepos(member.login);
      const cx = 100 + (i%5)*spacing;
      const cy = 150 + Math.floor(i/5)*spacing;
      galaxies.push({x:cx, y:cy, planets: buildGalaxy(repos,cx,cy)});
    }
  } else {
    // fetch as user
    const repos = await fetchRepos(input);
    galaxies.push({x:canvas.width/2, y:canvas.height/2, planets: buildGalaxy(repos,canvas.width/2,canvas.height/2)});
  }
});

// Load featured repos
document.getElementById('featuredBtn').addEventListener('click', async ()=>{
  const res = await fetch('https://api.github.com/search/repositories?q=stars:>10000&sort=stars&order=desc&per_page=50');
  const data = await res.json();
  galaxies = [];
  const spacing = 150;
  data.items.forEach((repo,i)=>{
    const cx = 100 + (i%10)*spacing;
    const cy = 100 + Math.floor(i/10)*spacing;
    galaxies.push({x:cx, y:cy, planets: buildGalaxy([repo],cx,cy)});
  });
});

// Handle window resize
window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
});
</script>

</body>
</html>
